# 文件审查：src-tauri/src/player/core.rs

## 轮次 1/5 - 架构与设计层面

1. **PlayerCore持有过多资源句柄**
   - 位置: lines 59-93
   - 原因: 持有5个Actor句柄、线程句柄、watch receiver等
   - 影响: 职责过多，违反单一职责原则
   - 建议: 考虑使用Builder模式或分解职责
   - 优先级: P2

2. **时间戳比较使用AtomicI64可能不够精确**
   - 位置: lines 92, 268-276
   - 原因: 毫秒级时间戳用i64存储，2262年溢出
   - 影响: 长期运行风险
   - 建议: 使用AtomicU64
   - 优先级: P3

3. **配置缺少验证**
   - 位置: PlayerCoreConfig结构
   - 原因: capacity和size可以设置为0或负数
   - 影响: 可能导致运行时错误
   - 建议: 在new中验证配置
   - 优先级: P2

## 轮次 2/5 - 安全与风险层面

1. **playback线程panic未处理**
   - 位置: lines 176-206
   - 原因: 如果playback线程panic，主程序无法感知
   - 影响: 静默失败
   - 建议: 使用catch_unwind或监控线程健康
   - 优先级: P1

## 轮次 3/5 - 性能与并发层面

1. **shutdown等待Actor可能死锁**
   - 位置: lines 536-568
   - 原因: 顺序关闭Actors，如果某个Actor阻塞会卡住
   - 影响: 程序无法正常退出
   - 建议: 并发关闭或添加超时
   - 优先级: P1

2. **过多的clone操作**
   - 位置: lines 318, 415, 429, 447等
   - 原因: Track频繁clone
   - 影响: 内存和性能开销
   - 建议: 使用Arc<Track>
   - 优先级: P2

3. **println!过多影响性能**
   - 位置: 贯穿整个文件
   - 原因: 大量println!用于调试
   - 影响: IO操作影响性能
   - 建议: 移除或使用条件编译
   - 优先级: P2

## 轮次 4/5 - 代码质量与类型安全层面

1. **过度使用unwrap**
   - 位置: lines 326, 469, 470等
   - 原因: `unwrap()`可能panic
   - 影响: 稳定性问题
   - 建议: 使用?或明确处理
   - 优先级: P1

2. **Drop实现不完整**
   - 位置: lines 571-578
   - 原因: 只abort任务，不等待完成
   - 影响: 资源可能未释放
   - 建议: 在文档中说明，或实现完整清理
   - 优先级: P2

## 轮次 5/5 - 细节与Bug层面

1. **test模块中unwrap未处理**
   - 位置: lines 590, 602
   - 原因: 测试中大量unwrap
   - 影响: 测试本身可能panic
   - 建议: 使用expect with message
   - 优先级: P3

**总问题数**: 11
**耗时**: 15分钟



