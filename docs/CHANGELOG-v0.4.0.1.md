# v0.4.0.1.0.1 更新日志

> 发布日期: 2025-10-06  
> 类型: 性能优化与架构升级

---

## 🚀 重大更新

### 🎵 播放器引擎架构重构

**从 Rust 后端播放器切换到 Web Audio API 前端播放器**

#### 性能提升

| 指标 | v0.4.0.1.0（旧） | v0.4.0.1.0.1（新） | 提升 |
|------|-------------|---------------|------|
| **FLAC 解码时间** | 5-8 秒 | 100-500ms | ⚡ **10-20倍** |
| **点击播放延迟** | 5-8 秒 | < 1 秒 | ⚡ **5-8倍** |
| **Seek 响应时间** | 200-500ms | < 10ms | ⚡ **20-50倍** |
| **Seek 精度** | 100ms | 1ms | ⚡ **100倍** |

#### 技术架构

**旧架构（Rust 后端播放）**:
```
前端点击播放 → Rust IPC → Rodio 解码（5-8秒） → 播放
```

**新架构（Web Audio API）**:
```
前端点击播放 → Tauri FS 读取文件（10ms） → Web Audio 解码（200ms） → 播放
```

#### 核心改进

1. **解码性能优化**
   - 使用浏览器内置 Web Audio API 解码器
   - 利用硬件加速（GPU）
   - FLAC 解码速度提升 10-20 倍

2. **Seek 零延迟**
   - 完整音频解码到内存（AudioBuffer）
   - Seek 操作纯内存指针移动，< 10ms
   - 支持任意精度跳转（1ms 级别）

3. **IPC 性能提升**
   - 移除大数据 IPC 传输瓶颈
   - 使用 Tauri fs 插件直接读取文件
   - 文件读取耗时从 5 秒降至 10ms

---

## 🎨 界面优化

- **播放响应优化** - 点击播放立即反馈，无需等待
- **进度条改进** - Seek 拖拽流畅，0 延迟响应
- **沉浸式歌词优化** - 歌词点击跳转瞬间完成

---

## 🔧 技术细节

### 新增依赖

**前端**:
- `@tauri-apps/plugin-fs` - 高性能文件系统访问

**后端**:
- `tauri-plugin-fs` - Rust fs 插件支持

### 核心代码

**Web Audio Player** (`src/services/webAudioPlayer.ts`):
- 完整的 Web Audio API 封装
- 支持播放、暂停、seek、音量控制
- 自动播放列表管理

**播放控制集成**:
- `src/App.tsx` - 主播放逻辑
- `src/components/PlaylistPlayer.tsx` - 播放控制按钮
- `src/components/ImmersiveLyricsView.tsx` - 沉浸式歌词 seek
- `src/contexts/PlaybackContext.tsx` - 状态管理

---

## 📝 已知限制

### 内存占用
- 每首歌完整解码到内存（30-50MB/首）
- 建议：8GB+ 内存的设备

### 适用场景
- ✅ 本地音乐播放（完美）
- ⏳ WebDAV 远程播放（待优化）

---

## 🔄 下一步计划

v0.4.0.1.1 计划功能：
- 🔄 **双引擎混合播放** - 流式播放 + Web Audio 自动切换
- 🔄 **WebDAV Web Audio 支持** - 远程文件也能 0 延迟 seek
- 🔄 **智能缓存策略** - 根据文件大小选择播放方式
- 🔄 **后台预加载优化** - 预测用户行为，提前加载

---

## 🙏 致谢

感谢开源社区提供的技术支持：
- **Web Audio API** - MDN 详细文档
- **Tauri 插件生态** - 高性能文件系统访问
- **开源音频库** - 音频处理技术参考

---

**v0.4.0.1.0.1 - 让播放如风铃般轻盈流畅** 🎵

