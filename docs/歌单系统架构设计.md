# ğŸ—ï¸ æ­Œå•ç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [è®¾è®¡åŸåˆ™](#è®¾è®¡åŸåˆ™)
2. [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
3. [æ¨¡å—è®¾è®¡](#æ¨¡å—è®¾è®¡)
4. [æ•°æ®æµ](#æ•°æ®æµ)
5. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
6. [å®‰å…¨æ€§](#å®‰å…¨æ€§)

---

## è®¾è®¡åŸåˆ™

### 1. é«˜å†…èšä½è€¦åˆ

#### åç«¯ï¼ˆRustï¼‰

**é«˜å†…èš**ï¼š
- `manager.rs` - æ‰€æœ‰ä¸šåŠ¡é€»è¾‘é›†ä¸­åœ¨PlaylistManager
- `smart_playlist.rs` - æ™ºèƒ½æ­Œå•å¼•æ“ç‹¬ç«‹å°è£…
- `exporter.rs` / `importer.rs` - å¯¼å…¥å¯¼å‡ºåŠŸèƒ½ç‹¬ç«‹

**ä½è€¦åˆ**ï¼š
- PlaylistManager **ä¾èµ–æŠ½è±¡**ï¼ˆDatabase traitï¼‰ï¼Œè€Œéå…·ä½“å®ç°
- é€šè¿‡Tauri Commandæ¥å£ä¸å‰ç«¯äº¤äº’
- æ¨¡å—é—´é€šè¿‡æ˜ç¡®çš„å…¬å…±APIé€šä¿¡

```rust
// âœ… å¥½çš„è®¾è®¡ï¼šä¾èµ–æŠ½è±¡
pub struct PlaylistManager {
    db: Arc<Mutex<Database>>, // å¯ä»¥æ›¿æ¢ä¸ºä»»ä½•å®ç°
}

// âŒ åçš„è®¾è®¡ï¼šä¾èµ–å…·ä½“å®ç°
pub struct PlaylistManager {
    sqlite_conn: SqliteConnection, // ç´§è€¦åˆ
}
```

#### å‰ç«¯ï¼ˆReactï¼‰

**é«˜å†…èš**ï¼š
- `PlaylistContext` - æ‰€æœ‰æ­Œå•çŠ¶æ€å’ŒAPIè°ƒç”¨é›†ä¸­
- æ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½

**ä½è€¦åˆ**ï¼š
- ç»„ä»¶é€šè¿‡Propsæ¥æ”¶æ•°æ®ï¼Œä¸ç›´æ¥è®¿é—®Context
- ä½¿ç”¨äº‹ä»¶ä¸ŠæŠ¥è€Œéç›´æ¥è°ƒç”¨çˆ¶ç»„ä»¶æ–¹æ³•
- å±•ç¤ºç»„ä»¶ä¸é€»è¾‘ç»„ä»¶åˆ†ç¦»

```tsx
// âœ… å¥½çš„è®¾è®¡ï¼šçº¯å±•ç¤ºç»„ä»¶
const PlaylistCard = ({ playlist, onClick, onFavorite }) => {
  // åªè´Ÿè´£å±•ç¤ºï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
};

// âŒ åçš„è®¾è®¡ï¼šåŒ…å«ä¸šåŠ¡é€»è¾‘
const PlaylistCard = ({ playlistId }) => {
  const data = usePlaylist(); // ç´§è€¦åˆ
  const handleDelete = async () => {
    await invoke('delete_playlist'); // ç›´æ¥è°ƒç”¨API
  };
};
```

### 2. å•ä¸€èŒè´£åŸåˆ™

æ¯ä¸ªæ¨¡å—/ç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½ï¼š

| æ¨¡å— | èŒè´£ |
|------|------|
| `manager.rs` | æ­Œå•ä¸šåŠ¡é€»è¾‘ |
| `smart_playlist.rs` | è§„åˆ™è§£æå’Œæ‰§è¡Œ |
| `exporter.rs` | å¯¼å‡ºåŠŸèƒ½ |
| `PlaylistContext` | çŠ¶æ€ç®¡ç†å’ŒAPIå°è£… |
| `PlaylistCard` | å±•ç¤ºå•ä¸ªæ­Œå• |
| `PlaylistsView` | åè°ƒåˆ—è¡¨å±•ç¤º |

### 3. ä¾èµ–å€’ç½®åŸåˆ™

é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—ï¼Œéƒ½ä¾èµ–æŠ½è±¡ï¼š

```rust
// æŠ½è±¡å±‚
pub trait PlaylistRepository {
    fn create(&self, playlist: Playlist) -> Result<i64>;
    fn get(&self, id: i64) -> Result<Playlist>;
}

// é«˜å±‚æ¨¡å—ä¾èµ–æŠ½è±¡
pub struct PlaylistManager<R: PlaylistRepository> {
    repo: R,
}

// ä½å±‚æ¨¡å—å®ç°æŠ½è±¡
impl PlaylistRepository for Database {
    // ...
}
```

---

## æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å‰ç«¯å±‚                                â”‚
â”‚                    (React/TypeScript)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  UI Components                Context API                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ PlaylistCard â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤PlaylistContext â”‚             â”‚
â”‚  â”‚ PlaylistsViewâ”‚           â”‚  - State       â”‚             â”‚
â”‚  â”‚ PlaylistDetail           â”‚  - Actions     â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                    â”‚                          â”‚
â”‚                                    â–¼                          â”‚
â”‚                             Tauri Invoke API                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Tauri Command Layer                      â”‚
â”‚                         (lib.rs)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  playlists_create, playlists_update, playlists_delete  â”‚ â”‚
â”‚  â”‚  playlists_export, playlists_import, ...               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ä¸šåŠ¡é€»è¾‘å±‚                            â”‚
â”‚                      (playlist/manager.rs)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   PlaylistManager                       â”‚ â”‚
â”‚  â”‚  - create_playlist()                                    â”‚ â”‚
â”‚  â”‚  - update_playlist()                                    â”‚ â”‚
â”‚  â”‚  - delete_playlist()                                    â”‚ â”‚
â”‚  â”‚  - refresh_smart_playlist()                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                        â”‚                           â”‚
â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
â”‚         â–¼                        â–¼                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚SmartPlaylistâ”‚         â”‚  Exporter/   â”‚                  â”‚
â”‚  â”‚   Engine    â”‚         â”‚  Importer    â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ•°æ®è®¿é—®å±‚                            â”‚
â”‚                          (db.rs)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      Database                           â”‚ â”‚
â”‚  â”‚  - create_playlist_extended()                           â”‚ â”‚
â”‚  â”‚  - get_all_playlists_extended()                         â”‚ â”‚
â”‚  â”‚  - update_playlist_metadata()                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                              SQLite Database
```

---

## æ¨¡å—è®¾è®¡

### åç«¯æ¨¡å—

#### 1. playlist/types.rs

**èŒè´£**ï¼šç±»å‹å®šä¹‰å’Œæ•°æ®ç»“æ„

```rust
pub struct Playlist {
    pub id: i64,
    pub name: String,
    pub is_smart: bool,
    pub smart_rules: Option<String>,
    // ...
}

pub struct SmartRules {
    pub rules: Vec<SmartRule>,
    pub match_all: bool,
    pub limit: Option<i64>,
}
```

**è®¾è®¡è¦ç‚¹**ï¼š
- æ‰€æœ‰å­—æ®µéƒ½æœ‰æ˜ç¡®çš„ç±»å‹
- ä½¿ç”¨Optionè¡¨ç¤ºå¯é€‰å­—æ®µ
- å®ç°Serialize/Deserializeç”¨äºJSONåºåˆ—åŒ–

#### 2. playlist/manager.rs

**èŒè´£**ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘

**å…³é”®æ–¹æ³•**ï¼š
```rust
impl PlaylistManager {
    pub fn new(db: Arc<Mutex<Database>>) -> Self;
    pub fn create_playlist(&self, options: CreatePlaylistOptions) -> Result<i64>;
    pub fn update_playlist(&self, id: i64, options: UpdatePlaylistOptions) -> Result<()>;
    pub fn delete_playlist(&self, id: i64) -> Result<()>;
    pub fn refresh_smart_playlist(&self, id: i64) -> Result<()>;
}
```

**è®¾è®¡è¦ç‚¹**ï¼š
- æ‰€æœ‰æ–¹æ³•éƒ½è¿”å›Resultå¤„ç†é”™è¯¯
- ä½¿ç”¨Arc<Mutex<>>å®ç°çº¿ç¨‹å®‰å…¨
- è‡ªåŠ¨åˆ·æ–°æ™ºèƒ½æ­Œå•

#### 3. playlist/smart_playlist.rs

**èŒè´£**ï¼šæ™ºèƒ½è§„åˆ™è§£æå’Œæ‰§è¡Œ

```rust
pub struct SmartPlaylistEngine;

impl SmartPlaylistEngine {
    pub fn filter_tracks(tracks: &[Track], rules: &SmartRules) -> Result<Vec<Track>>;
    pub fn build_sql_where_clause(rules: &SmartRules) -> Option<(String, Vec<String>)>;
}
```

**è®¾è®¡è¦ç‚¹**ï¼š
- æ”¯æŒAND/ORé€»è¾‘
- ä¼˜åŒ–SQLæŸ¥è¯¢
- æ”¯æŒå¤šç§å­—æ®µç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€æ—¥æœŸã€å¸ƒå°”ï¼‰

### å‰ç«¯æ¨¡å—

#### 1. contexts/PlaylistContext.tsx

**èŒè´£**ï¼šå…¨å±€çŠ¶æ€ç®¡ç†

**çŠ¶æ€**ï¼š
```typescript
playlists: Playlist[]           // æ‰€æœ‰æ­Œå•
currentPlaylist: PlaylistWithTracks | null  // å½“å‰è¯¦æƒ…
loading: boolean                // åŠ è½½çŠ¶æ€
error: string | null           // é”™è¯¯ä¿¡æ¯
stats: PlaylistStats | null    // ç»Ÿè®¡ä¿¡æ¯
```

**æ–¹æ³•**ï¼š
- CRUDæ“ä½œ
- æ™ºèƒ½æ­Œå•ç®¡ç†
- å¯¼å…¥å¯¼å‡º
- ç»Ÿè®¡æŸ¥è¯¢

**è®¾è®¡è¦ç‚¹**ï¼š
- ä½¿ç”¨useCallbacké¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
- ç»Ÿä¸€é”™è¯¯å¤„ç†
- è‡ªåŠ¨åˆ·æ–°ç›¸å…³çŠ¶æ€

#### 2. components/playlist/PlaylistCard.tsx

**èŒè´£**ï¼šå±•ç¤ºå•ä¸ªæ­Œå•å¡ç‰‡

**Props**ï¼š
```typescript
{
  playlist: Playlist;
  onClick?: () => void;
  onFavoriteToggle?: () => void;
  className?: string;
}
```

**è®¾è®¡è¦ç‚¹**ï¼š
- çº¯å±•ç¤ºç»„ä»¶ï¼Œæ— ä¸šåŠ¡é€»è¾‘
- é€šè¿‡Propsæ¥æ”¶æ‰€æœ‰æ•°æ®
- é€šè¿‡å›è°ƒæŠ¥å‘Šç”¨æˆ·æ“ä½œ

---

## æ•°æ®æµ

### åˆ›å»ºæ­Œå•æµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»"åˆ›å»º"æŒ‰é’®
   â”‚
   â–¼
2. æ˜¾ç¤ºCreatePlaylistDialog
   â”‚
   â–¼
3. ç”¨æˆ·å¡«å†™è¡¨å•å¹¶æäº¤
   â”‚
   â–¼
4. è°ƒç”¨Context.createPlaylist()
   â”‚
   â–¼
5. invoke('playlists_create', options)
   â”‚
   â–¼
6. Rust: playlists_createå‘½ä»¤
   â”‚
   â–¼
7. PlaylistManager.create_playlist()
   â”‚
   â–¼
8. Database.create_playlist_extended()
   â”‚
   â–¼
9. SQLite INSERTæ“ä½œ
   â”‚
   â–¼
10. è¿”å›playlist_id
   â”‚
   â–¼
11. Contextè‡ªåŠ¨åˆ·æ–°åˆ—è¡¨
   â”‚
   â–¼
12. UIæ›´æ–°æ˜¾ç¤ºæ–°æ­Œå•
```

### æ™ºèƒ½æ­Œå•åˆ·æ–°æµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»"åˆ·æ–°"æˆ–è§„åˆ™å˜æ›´
   â”‚
   â–¼
2. Context.refreshSmartPlaylist(id)
   â”‚
   â–¼
3. PlaylistManager.refresh_smart_playlist()
   â”‚
   â–¼
4. è·å–æ­Œå•å’Œè§„åˆ™
   â”‚
   â–¼
5. SmartPlaylistEngine.filter_tracks()
   â”‚
   â”œâ”€â–º åº”ç”¨è§„åˆ™ç­›é€‰
   â”‚
   â”œâ”€â–º åº”ç”¨AND/ORé€»è¾‘
   â”‚
   â””â”€â–º åº”ç”¨limité™åˆ¶
   â”‚
   â–¼
6. æ¸…ç©ºç°æœ‰æ›²ç›®
   â”‚
   â–¼
7. æ·»åŠ ç­›é€‰åçš„æ›²ç›®
   â”‚
   â–¼
8. æ›´æ–°updated_atæ—¶é—´æˆ³
   â”‚
   â–¼
9. Contextåˆ·æ–°åˆ—è¡¨å’Œè¯¦æƒ…
   â”‚
   â–¼
10. UIæ›´æ–°æ˜¾ç¤º
```

---

## æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®åº“å±‚

**ç´¢å¼•ä¼˜åŒ–**ï¼š
```sql
CREATE INDEX idx_playlists_is_smart ON playlists(is_smart);
CREATE INDEX idx_playlists_is_favorite ON playlists(is_favorite);
CREATE INDEX idx_playlist_items_playlist_id ON playlist_items(playlist_id);
```

**æŸ¥è¯¢ä¼˜åŒ–**ï¼š
```sql
-- ä½¿ç”¨JOINå’ŒGROUP BYä¸€æ¬¡æ€§è·å–æ­Œå•å’Œç»Ÿè®¡ä¿¡æ¯
SELECT p.*, COUNT(pi.id) as track_count, COALESCE(SUM(t.duration_ms), 0) as total_duration
FROM playlists p
LEFT JOIN playlist_items pi ON p.id = pi.playlist_id
LEFT JOIN tracks t ON pi.track_id = t.id
GROUP BY p.id;
```

### 2. å‰ç«¯å±‚

**useMemoç¼“å­˜è®¡ç®—ç»“æœ**ï¼š
```tsx
const filteredPlaylists = useMemo(() => {
  return playlists.filter(/* ... */);
}, [playlists, filterCriteria]);
```

**useCallbacké¿å…é‡æ–°åˆ›å»ºå‡½æ•°**ï¼š
```tsx
const handleClick = useCallback(() => {
  // ...
}, [dependencies]);
```

**è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤§åˆ—è¡¨ï¼‰**ï¼š
```tsx
// ä½¿ç”¨react-windowæˆ–react-virtualized
import { FixedSizeList } from 'react-window';
```

### 3. æ™ºèƒ½æ­Œå•ä¼˜åŒ–

**SQLä¼˜å…ˆ**ï¼š
```rust
// ä¼˜å…ˆä½¿ç”¨SQLæŸ¥è¯¢è€Œéå†…å­˜ç­›é€‰
if let Some((where_clause, params)) = SmartPlaylistEngine::build_sql_where_clause(rules) {
    // ä½¿ç”¨SQLæŸ¥è¯¢
} else {
    // å›é€€åˆ°å†…å­˜ç­›é€‰
}
```

---

## å®‰å…¨æ€§

### 1. SQLæ³¨å…¥é˜²æŠ¤

**âœ… ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢**ï¼š
```rust
stmt.execute(params![playlist_id, track_id])?;
```

**âŒ ä¸è¦æ‹¼æ¥SQL**ï¼š
```rust
// å±é™©ï¼
let sql = format!("DELETE FROM playlists WHERE id = {}", id);
```

### 2. è¾“å…¥éªŒè¯

```rust
// åç«¯éªŒè¯
if name.len() > 100 {
    return Err(anyhow::anyhow!("åç§°è¿‡é•¿"));
}

// å‰ç«¯éªŒè¯
if (!name.trim()) {
    errors.name = 'è¯·è¾“å…¥æ­Œå•åç§°';
}
```

### 3. æƒé™æ§åˆ¶

```rust
// æ£€æŸ¥ç”¨æˆ·æƒé™ï¼ˆå¦‚æœéœ€è¦ï¼‰
if !user.can_delete_playlist(playlist_id) {
    return Err(anyhow::anyhow!("æ— æƒé™"));
}
```

---

## æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•ï¼ˆRustï¼‰

```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_filter_by_artist() {
        let tracks = vec![/* ... */];
        let rules = SmartRules {
            rules: vec![SmartRule {
                field: RuleField::Artist,
                operator: RuleOperator::Equals,
                value: "Artist A".to_string(),
            }],
            match_all: true,
            limit: None,
        };

        let filtered = SmartPlaylistEngine::filter_tracks(&tracks, &rules).unwrap();
        assert_eq!(filtered.len(), 2);
    }
}
```

### é›†æˆæµ‹è¯•ï¼ˆReactï¼‰

```tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { PlaylistProvider } from './contexts/PlaylistContext';
import { PlaylistsView } from './components/playlist';

test('åˆ›å»ºæ­Œå•æµç¨‹', async () => {
  render(
    <PlaylistProvider>
      <PlaylistsView />
    </PlaylistProvider>
  );

  // ç‚¹å‡»åˆ›å»ºæŒ‰é’®
  fireEvent.click(screen.getByText('åˆ›å»ºæ­Œå•'));
  
  // å¡«å†™è¡¨å•
  fireEvent.change(screen.getByPlaceholderText('æ­Œå•åç§°'), {
    target: { value: 'æµ‹è¯•æ­Œå•' }
  });
  
  // æäº¤
  fireEvent.click(screen.getByText('åˆ›å»º'));
  
  // éªŒè¯ç»“æœ
  await screen.findByText('æµ‹è¯•æ­Œå•');
});
```

---

**æ–‡æ¡£å®Œæˆï¼** ğŸ‰

