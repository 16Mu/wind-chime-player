# ğŸµ ä¼ä¸šçº§æ­Œå•ç³»ç»Ÿ - ä½¿ç”¨æŒ‡å—

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- âœ… **å®Œæ•´çš„CRUDæ“ä½œ** - åˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤æ­Œå•
- âœ… **æ™ºèƒ½æ­Œå•** - æ ¹æ®è§„åˆ™è‡ªåŠ¨ç­›é€‰æ›²ç›®
- âœ… **æ‹–æ‹½é‡æ’** - æ”¯æŒæ›²ç›®æ‹–æ‹½é‡æ–°æ’åº
- âœ… **å¯¼å…¥å¯¼å‡º** - æ”¯æŒM3U/M3U8/JSONæ ¼å¼
- âœ… **æ”¶è—åŠŸèƒ½** - æ ‡è®°å¸¸ç”¨æ­Œå•
- âœ… **ç»Ÿè®¡ä¿¡æ¯** - æ’­æ”¾æ¬¡æ•°ã€æ›²ç›®æ•°ç­‰

### ğŸ—ï¸ æ¶æ„è®¾è®¡

#### é«˜å†…èšä½è€¦åˆ
```
åç«¯ (Rust)
â”œâ”€â”€ playlist/mod.rs          - æ¨¡å—å…¥å£
â”œâ”€â”€ playlist/types.rs        - ç±»å‹å®šä¹‰
â”œâ”€â”€ playlist/manager.rs      - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ playlist/smart_playlist.rs - æ™ºèƒ½æ­Œå•å¼•æ“
â”œâ”€â”€ playlist/exporter.rs     - å¯¼å‡ºåŠŸèƒ½
â””â”€â”€ playlist/importer.rs     - å¯¼å…¥åŠŸèƒ½

å‰ç«¯ (React/TypeScript)
â”œâ”€â”€ contexts/PlaylistContext.tsx  - çŠ¶æ€ç®¡ç†ï¼ˆå•ä¸€æ•°æ®æºï¼‰
â”œâ”€â”€ components/playlist/
â”‚   â”œâ”€â”€ PlaylistCard.tsx         - çº¯å±•ç¤ºç»„ä»¶
â”‚   â”œâ”€â”€ PlaylistsView.tsx        - å®¹å™¨ç»„ä»¶
â”‚   â”œâ”€â”€ PlaylistDetail.tsx       - è¯¦æƒ…é¡µç»„ä»¶
â”‚   â”œâ”€â”€ CreatePlaylistDialog.tsx - å¯¹è¯æ¡†ç»„ä»¶
â”‚   â””â”€â”€ SmartPlaylistEditor.tsx  - æ™ºèƒ½è§„åˆ™ç¼–è¾‘å™¨
â””â”€â”€ types/                        - TypeScriptç±»å‹å®šä¹‰
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é›†æˆåˆ°åº”ç”¨

#### 1.1 æ·»åŠ Provider

åœ¨ä½ çš„æ ¹ç»„ä»¶ä¸­æ·»åŠ `PlaylistProvider`:

```tsx
// src/App.tsx
import { PlaylistProvider } from './contexts/PlaylistContext';

function App() {
  return (
    <PlaylistProvider>
      {/* ä½ çš„åº”ç”¨ç»„ä»¶ */}
      <YourAppContent />
    </PlaylistProvider>
  );
}
```

#### 1.2 ä½¿ç”¨æ­Œå•åˆ—è¡¨è§†å›¾

```tsx
import { PlaylistsView } from './components/playlist';
import { useState } from 'react';

function YourPlaylistPage() {
  const [showCreateDialog, setShowCreateDialog] = useState(false);
  const [selectedPlaylistId, setSelectedPlaylistId] = useState<number | null>(null);

  return (
    <div>
      {selectedPlaylistId ? (
        // æ˜¾ç¤ºæ­Œå•è¯¦æƒ…
        <PlaylistDetail 
          playlistId={selectedPlaylistId}
          onBack={() => setSelectedPlaylistId(null)}
        />
      ) : (
        // æ˜¾ç¤ºæ­Œå•åˆ—è¡¨
        <PlaylistsView
          onCreateClick={() => setShowCreateDialog(true)}
          onPlaylistClick={(id) => setSelectedPlaylistId(id)}
        />
      )}
      
      {showCreateDialog && (
        <CreatePlaylistDialog
          isOpen={showCreateDialog}
          onClose={() => setShowCreateDialog(false)}
          onSuccess={(id) => {
            setShowCreateDialog(false);
            setSelectedPlaylistId(id);
          }}
        />
      )}
    </div>
  );
}
```

### 2. ä½¿ç”¨Context API

#### 2.1 åŸºæœ¬æ“ä½œ

```tsx
import { usePlaylist } from './contexts/PlaylistContext';

function MyComponent() {
  const {
    playlists,          // æ‰€æœ‰æ­Œå•
    currentPlaylist,    // å½“å‰é€‰ä¸­çš„æ­Œå•è¯¦æƒ…
    loading,            // åŠ è½½çŠ¶æ€
    error,              // é”™è¯¯ä¿¡æ¯
    
    // æ“ä½œæ–¹æ³•
    createPlaylist,
    updatePlaylist,
    deletePlaylist,
  } = usePlaylist();

  // åˆ›å»ºæ­Œå•
  const handleCreate = async () => {
    const options = {
      name: 'æˆ‘çš„æ–°æ­Œå•',
      description: 'æè¿°ä¿¡æ¯',
      color_theme: '#8B5CF6',
      is_smart: false,
      smart_rules: undefined,
    };
    
    const playlistId = await createPlaylist(options);
    console.log('åˆ›å»ºæˆåŠŸï¼ŒID:', playlistId);
  };

  return (
    <div>
      {/* ä½ çš„UI */}
    </div>
  );
}
```

#### 2.2 æ™ºèƒ½æ­Œå•

```tsx
import { usePlaylist } from './contexts/PlaylistContext';

function SmartPlaylistExample() {
  const { createSmartPlaylist, updateSmartPlaylistRules } = usePlaylist();

  const handleCreateSmart = async () => {
    const rules = {
      rules: [
        {
          field: 'artist',
          operator: 'equals',
          value: 'Taylor Swift',
        },
        {
          field: 'duration',
          operator: 'less_than',
          value: '300000', // 5åˆ†é’Ÿ
        },
      ],
      match_all: true, // ANDé€»è¾‘
      limit: 50,        // æœ€å¤š50é¦–
    };

    const id = await createSmartPlaylist('Taylor Swift çŸ­æ›²', rules);
    console.log('æ™ºèƒ½æ­Œå•åˆ›å»ºæˆåŠŸ:', id);
  };

  return <button onClick={handleCreateSmart}>åˆ›å»ºæ™ºèƒ½æ­Œå•</button>;
}
```

## ğŸ“š APIå‚è€ƒ

### PlaylistContext API

#### çŠ¶æ€

| å±æ€§ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `playlists` | `Playlist[]` | æ‰€æœ‰æ­Œå•åˆ—è¡¨ |
| `currentPlaylist` | `PlaylistWithTracks \| null` | å½“å‰æ­Œå•è¯¦æƒ…ï¼ˆåŒ…å«æ›²ç›®ï¼‰ |
| `stats` | `PlaylistStats \| null` | ç»Ÿè®¡ä¿¡æ¯ |
| `loading` | `boolean` | åŠ è½½çŠ¶æ€ |
| `error` | `string \| null` | é”™è¯¯ä¿¡æ¯ |

#### æ–¹æ³•

##### CRUDæ“ä½œ

```typescript
// åŠ è½½æ­Œå•åˆ—è¡¨
loadPlaylists: () => Promise<void>

// åˆ›å»ºæ­Œå•
createPlaylist: (options: CreatePlaylistOptions) => Promise<number>

// è·å–æ­Œå•è¯¦æƒ…
getPlaylistDetail: (id: number) => Promise<void>

// æ›´æ–°æ­Œå•
updatePlaylist: (id: number, options: UpdatePlaylistOptions) => Promise<void>

// åˆ é™¤æ­Œå•
deletePlaylist: (id: number) => Promise<void>
```

##### æ›²ç›®ç®¡ç†

```typescript
// æ·»åŠ æ›²ç›®
addTracksToPlaylist: (playlistId: number, trackIds: number[]) => Promise<void>

// ç§»é™¤æ›²ç›®
removeTrackFromPlaylist: (playlistId: number, trackId: number) => Promise<void>

// é‡æ’æ›²ç›®
reorderTracks: (playlistId: number, trackIds: number[]) => Promise<void>
```

##### æ™ºèƒ½æ­Œå•

```typescript
// åˆ›å»ºæ™ºèƒ½æ­Œå•
createSmartPlaylist: (name: string, rules: SmartRules) => Promise<number>

// æ›´æ–°è§„åˆ™
updateSmartPlaylistRules: (id: number, rules: SmartRules) => Promise<void>

// åˆ·æ–°æ™ºèƒ½æ­Œå•
refreshSmartPlaylist: (id: number) => Promise<void>

// åˆ·æ–°æ‰€æœ‰æ™ºèƒ½æ­Œå•
refreshAllSmartPlaylists: () => Promise<void>
```

##### å¯¼å…¥å¯¼å‡º

```typescript
// å¯¼å‡ºæ­Œå•
exportPlaylist: (id: number, filePath: string, format: ExportFormat) => Promise<void>

// é¢„è§ˆå¯¼å‡ºå†…å®¹
exportPlaylistPreview: (id: number, format: ExportFormat) => Promise<string>

// å¯¼å…¥æ­Œå•
importPlaylist: (filePath: string) => Promise<number>
```

## ğŸ¨ ç»„ä»¶Propså‚è€ƒ

### PlaylistCard

```typescript
interface PlaylistCardProps {
  playlist: Playlist;           // æ­Œå•æ•°æ®
  onClick?: () => void;         // ç‚¹å‡»äº‹ä»¶
  onFavoriteToggle?: () => void; // æ”¶è—åˆ‡æ¢
  className?: string;           // è‡ªå®šä¹‰æ ·å¼
}
```

### PlaylistsView

```typescript
interface PlaylistsViewProps {
  onCreateClick?: () => void;           // åˆ›å»ºæŒ‰é’®ç‚¹å‡»
  onPlaylistClick?: (id: number) => void; // æ­Œå•ç‚¹å‡»
}
```

### PlaylistDetail

```typescript
interface PlaylistDetailProps {
  playlistId: number;                    // æ­Œå•ID
  onBack?: () => void;                   // è¿”å›
  onEdit?: () => void;                   // ç¼–è¾‘
  onPlayTrack?: (trackId: number) => void; // æ’­æ”¾æ›²ç›®
  onAddTracks?: () => void;              // æ·»åŠ æ›²ç›®
}
```

### CreatePlaylistDialog

```typescript
interface CreatePlaylistDialogProps {
  isOpen: boolean;                       // æ˜¯å¦æ˜¾ç¤º
  onClose: () => void;                   // å…³é—­
  editPlaylist?: Playlist;              // ç¼–è¾‘æ¨¡å¼ï¼šæ­Œå•æ•°æ®
  onSuccess?: (id: number) => void;     // æˆåŠŸå›è°ƒ
}
```

### SmartPlaylistEditor

```typescript
interface SmartPlaylistEditorProps {
  playlistId?: number;                  // æ­Œå•IDï¼ˆç¼–è¾‘æ¨¡å¼ï¼‰
  initialRules?: SmartRules;            // åˆå§‹è§„åˆ™
  onSave?: (rules: SmartRules) => void; // ä¿å­˜å›è°ƒ
  onCancel?: () => void;                // å–æ¶ˆå›è°ƒ
}
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. çŠ¶æ€ç®¡ç†

âœ… **æ¨è**ï¼šä½¿ç”¨Contextæä¾›çš„æ–¹æ³•
```tsx
const { createPlaylist } = usePlaylist();
await createPlaylist(options);
```

âŒ **ä¸æ¨è**ï¼šç›´æ¥è°ƒç”¨Tauriå‘½ä»¤
```tsx
// ä¸è¦è¿™æ ·åšï¼ä¼šå¯¼è‡´çŠ¶æ€ä¸åŒæ­¥
await invoke('playlists_create', { options });
```

### 2. é”™è¯¯å¤„ç†

```tsx
const { error, clearError } = usePlaylist();

useEffect(() => {
  if (error) {
    // æ˜¾ç¤ºé”™è¯¯æç¤º
    showNotification(error);
    // æ¸…é™¤é”™è¯¯
    clearError();
  }
}, [error]);
```

### 3. æ€§èƒ½ä¼˜åŒ–

```tsx
// ä½¿ç”¨useMemoé¿å…ä¸å¿…è¦çš„é‡æ–°è®¡ç®—
const sortedPlaylists = useMemo(() => {
  return [...playlists].sort((a, b) => 
    b.created_at - a.created_at
  );
}, [playlists]);
```

### 4. ç»„ä»¶ç»„åˆ

```tsx
// âœ… å¥½çš„åšæ³•ï¼šç»„åˆå°ç»„ä»¶
function MyPlaylistPage() {
  return (
    <div>
      <PlaylistsView />
      <CreatePlaylistDialog />
    </div>
  );
}

// âŒ ä¸å¥½çš„åšæ³•ï¼šæŠŠæ‰€æœ‰é€»è¾‘å†™åœ¨ä¸€ä¸ªå¤§ç»„ä»¶é‡Œ
```

## ğŸ”§ è‡ªå®šä¹‰å’Œæ‰©å±•

### 1. è‡ªå®šä¹‰æ ·å¼

æ‰€æœ‰ç»„ä»¶éƒ½æ¥å—`className` propï¼š

```tsx
<PlaylistCard 
  playlist={playlist}
  className="my-custom-styles"
/>
```

### 2. æ‰©å±•æ™ºèƒ½è§„åˆ™

åœ¨`SmartPlaylistEditor.tsx`ä¸­æ·»åŠ æ–°çš„å­—æ®µç±»å‹ï¼š

```typescript
const fieldOptions = [
  // ... ç°æœ‰å­—æ®µ
  { value: 'genre', label: 'æµæ´¾' },  // æ–°å¢
  { value: 'year', label: 'å¹´ä»½' },   // æ–°å¢
];
```

### 3. æ·»åŠ æ–°çš„å¯¼å‡ºæ ¼å¼

åœ¨åç«¯`exporter.rs`ä¸­å®ç°æ–°æ ¼å¼ï¼Œç„¶ååœ¨`ExportFormat`ç±»å‹ä¸­æ·»åŠ ï¼š

```typescript
export type ExportFormat = 'M3U' | 'M3U8' | 'JSON' | 'XML'; // æ–°å¢XML
```

## ğŸ“¦ æ‰“åŒ…å’Œéƒ¨ç½²

ç³»ç»Ÿå·²é›†æˆåˆ°Tauriåº”ç”¨ä¸­ï¼Œéšåº”ç”¨ä¸€èµ·æ‰“åŒ…ï¼š

```bash
# å¼€å‘æ¨¡å¼
npm run tauri dev

# ç”Ÿäº§æ„å»º
npm run tauri build
```

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šæ­Œå•åˆ›å»ºåä¸æ˜¾ç¤º

**åŸå› **ï¼šå¯èƒ½æ˜¯Contextæœªåˆ·æ–°

**è§£å†³**ï¼š
```tsx
await createPlaylist(options);
await loadPlaylists(); // æ‰‹åŠ¨åˆ·æ–°
```

### é—®é¢˜ï¼šæ™ºèƒ½æ­Œå•è§„åˆ™ä¸ç”Ÿæ•ˆ

**æ£€æŸ¥**ï¼š
1. è§„åˆ™è¯­æ³•æ˜¯å¦æ­£ç¡®
2. æ˜¯å¦è°ƒç”¨äº†`refreshSmartPlaylist`
3. æ•°æ®åº“ä¸­æ˜¯å¦æœ‰åŒ¹é…çš„æ›²ç›®

### é—®é¢˜ï¼šå¯¼å…¥å¤±è´¥

**æ£€æŸ¥**ï¼š
1. æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼ˆM3U/JSONï¼‰
2. æ–‡ä»¶è·¯å¾„æ˜¯å¦å­˜åœ¨
3. æ›²ç›®è·¯å¾„æ˜¯å¦åœ¨éŸ³ä¹åº“ä¸­

## ğŸ“„ è®¸å¯è¯

æœ¬æ­Œå•ç³»ç»Ÿéµå¾ªé¡¹ç›®ä¸»è®¸å¯è¯ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

---

**äº«å—ä½ çš„ä¼ä¸šçº§æ­Œå•ç³»ç»Ÿï¼** ğŸ‰

