# 设置搜索功能说明

## 📅 完成时间：2025年10月6日

---

## 🎯 功能概述

在应用左下角工具栏添加了设置搜索功能,点击搜索按钮后会:
1. 自动导航到设置页面
2. 显示搜索框,自动聚焦
3. 支持实时搜索设置分类
4. 高亮显示匹配的分类标签

---

## 🚀 使用方法

### 1. 打开设置搜索
- **方式一**: 点击左下角工具栏的搜索按钮 (🔍)
- **方式二**: 在设置页面时,搜索框会自动出现

### 2. 搜索设置项
- 在搜索框中输入关键词,例如:
  - `外观` - 搜索外观设置
  - `动画` - 搜索动画设置
  - `音乐` / `library` - 搜索音乐库设置
  - `主题` / `theme` - 搜索主题相关设置

### 3. 查看搜索结果
- 匹配的分类标签会:
  - **高亮显示**为琥珀色 (amber)
  - 右上角显示一个**小圆点标记**
- 不匹配的分类会变暗 (透明度30%)
- 顶部显示匹配数量提示

### 4. 关闭搜索
- **方式一**: 点击搜索框右侧的关闭按钮 (×)
- **方式二**: 按 `ESC` 键

---

## 🎨 UI特性

### 搜索框样式
- 宽度: 256px (w-64)
- 位置: 设置页面顶部右侧
- 支持深色/浅色主题自适应
- 带有清除按钮和搜索图标

### 搜索反馈
- **匹配标签**: 琥珀色高亮 + 小圆点标记
- **不匹配标签**: 透明度降低至30%
- **结果提示**: "找到 X 个匹配的设置分类"
- **空状态提示**: "未找到匹配的设置分类"

### 智能提示
当在不匹配的分类时,显示:
- 🔍 搜索图标
- 提示文字: "当前分类不匹配搜索条件"
- 快捷跳转按钮: "跳转到 [第一个匹配分类]"

---

## 🔧 技术实现

### 1. 状态管理 (UIContext)
新增状态:
```typescript
settingsSearchQuery: string        // 搜索查询文本
settingsSearchVisible: boolean     // 搜索框是否可见
```

新增方法:
```typescript
setSettingsSearchQuery(query: string)  // 设置搜索查询
clearSettingsSearch()                  // 清空搜索
showSettingsSearch()                   // 显示搜索框
hideSettingsSearch()                   // 隐藏搜索框
```

### 2. 组件更新

#### Sidebar.tsx
- 导入 `useUI` hook
- 搜索按钮点击事件:
  ```typescript
  onClick={() => {
    onNavigate('settings' as Page);
    showSettingsSearch();
  }}
  ```

#### SettingsPageNew.tsx
- 添加搜索框UI组件
- 实现搜索过滤逻辑:
  ```typescript
  const getFilteredTabs = () => {
    if (!settingsSearchQuery.trim()) return TABS;
    const query = settingsSearchQuery.toLowerCase();
    return TABS.filter(tab => 
      tab.label.toLowerCase().includes(query) ||
      tab.id.toLowerCase().includes(query)
    );
  };
  ```
- 添加键盘快捷键 (ESC关闭)
- 添加搜索结果反馈UI

### 3. 新组件

#### HighlightText.tsx
用于高亮显示搜索关键词的文本组件:
```typescript
<HighlightText 
  text="设置项标题" 
  query={searchQuery} 
/>
```

---

## 📝 搜索匹配规则

当前支持搜索:
1. **分类标签名称** (中文)
   - `音乐库`, `外观`, `动画`, `播放`, `远程音乐源`, `关于`
   
2. **分类ID** (英文)
   - `library`, `appearance`, `animation`, `playback`, `webdav`, `about`

匹配方式:
- 不区分大小写
- 支持部分匹配 (contains)

---

## 🎯 未来扩展

可以进一步扩展搜索功能:

1. **搜索设置项内容**
   - 搜索具体的设置选项 (例如: "高对比度", "主题")
   - 搜索设置描述文本
   
2. **搜索历史**
   - 保存最近的搜索记录
   - 提供搜索建议

3. **智能跳转**
   - 自动跳转到第一个匹配的分类
   - 在设置项内高亮匹配的选项

4. **快捷键支持**
   - `Ctrl/Cmd + K` 打开搜索
   - `↑↓` 键在搜索结果间导航

---

## ✅ 测试要点

1. **基本功能**
   - [ ] 点击搜索按钮能打开设置页面和搜索框
   - [ ] 搜索框自动聚焦
   - [ ] 输入关键词能实时过滤分类
   - [ ] 匹配的分类正确高亮显示

2. **交互体验**
   - [ ] ESC键能关闭搜索框
   - [ ] 点击关闭按钮能关闭搜索框
   - [ ] 清除按钮能清空搜索内容
   - [ ] 在不匹配分类时显示提示和跳转按钮

3. **主题适配**
   - [ ] 浅色模式下样式正常
   - [ ] 深色模式下样式正常
   - [ ] 高对比度模式下可读性良好

4. **边界情况**
   - [ ] 输入空格或空字符串时的处理
   - [ ] 搜索无结果时的提示
   - [ ] 快速切换分类时的状态保持

---

## 📊 代码统计

- **修改文件**: 3个
  - `src/contexts/UIContext.tsx`
  - `src/components/Sidebar.tsx`
  - `src/components/SettingsPageNew.tsx`

- **新增文件**: 2个
  - `src/components/settings/ui/HighlightText.tsx`
  - `docs/设置搜索功能说明-20251006.md`

- **新增代码行数**: ~150行
- **新增功能**: 设置搜索、键盘快捷键、搜索结果高亮

---

## 🎉 完成状态

✅ 基础搜索功能完成
✅ UI交互完成
✅ 键盘快捷键支持
✅ 搜索结果反馈
✅ 主题适配
✅ 文档说明

---

**备注**: 这是一个轻量级的搜索实现,主要针对设置分类级别的搜索。未来可以根据需要扩展到更细粒度的设置项搜索。

