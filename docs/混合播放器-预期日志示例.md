# 混合播放器 - 预期日志示例

> 展示完整的引擎切换过程  
> 带时间戳和时间间隔

---

## 🎵 播放流程完整日志

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎵 [HybridPlayer] [14:35:28.456] T+0ms - 播放: r.i.p. (Explicit)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⚡ [HybridPlayer] T+2ms - 【阶段1】启动 Rust 流式播放...

📋 [CORE] 处理LoadPlaylist命令: 19 首曲目
✅ [CORE] 播放列表加载完成

🎵 [COMMAND] player_play 被调用: track_id=2
▶️ [CORE] 处理Play命令: track_id=2
🎵 [PlaybackActor] 开始播放: r.i.p. (Explicit)
🎵 [PlaybackActor] 解码本地音频文件（流式播放，立即开始）
✅ [PlaybackActor] 本地文件流式解码器已创建（立即播放）
✅ [PlaybackActor] 音频源已准备 (耗时: 8ms)
▶️ [PlaybackActor] 添加音频源并开始播放...
✅ [PlaybackActor] 播放启动完成

✅ [HybridPlayer] T+95ms - Rust 播放器已启动 (耗时: 93ms)
🎵 [HybridPlayer] T+95ms - 🔊 用户听到声音了！

💾 [HybridPlayer] T+96ms - 【阶段2】后台加载 Web Audio（支持快速 seek）...
🔧 [HybridPlayer] T+96ms - 后台任务启动: Web Audio 完整解码
📖 [HybridPlayer] T+97ms - 开始读取文件...

📖 [WebAudioPlayer] 读取本地文件...
✅ [WebAudioPlayer] 文件读取完成 (20480488 字节, 耗时: 211ms)
🔄 [WebAudioPlayer] 开始解码音频...
✅ [WebAudioPlayer] 解码完成！
   - 解码耗时: 432ms
   - 总耗时: 643ms
   - 时长: 185s
   - 采样率: 48000Hz
   - 声道数: 2

✅ [HybridPlayer] T+739ms - Web Audio 后台加载完成 (耗时: 643ms)
🔄 [HybridPlayer] T+739ms - 【阶段3】准备切换引擎...
🔄 [HybridPlayer] T+740ms - 开始切换引擎...

📨 [CORE] 处理命令: GetPosition
📊 [HybridPlayer] T+745ms - 获取 Rust 播放位置: 650ms (耗时: 5ms)

⏹️ [HybridPlayer] T+750ms - Rust 播放器已停止 (耗时: 5ms)

▶️ [WebAudioPlayer] Seek 到 0.65s
▶️ [WebAudioPlayer] 开始播放 (偏移: 0.65s)

✅ [HybridPlayer] T+758ms - Web Audio 播放启动 (耗时: 8ms)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎉 [HybridPlayer] T+758ms - 引擎切换完成！ Rust → Web Audio (切换耗时: 18ms)
🎯 [HybridPlayer] T+758ms - ⚡ 现在支持 0 延迟 seek (<10ms)！
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

```

---

## ⚡ Seek 操作日志（切换后）

### 在 Web Audio 引擎下 Seek（0 延迟）

```
⚡ [HybridPlayer] Seek → 30.00s [引擎: Web Audio] [耗时: 3ms] ✨ 0 延迟!
⚡ [HybridPlayer] Seek → 60.50s [引擎: Web Audio] [耗时: 2ms] ✨ 0 延迟!
⚡ [HybridPlayer] Seek → 90.25s [引擎: Web Audio] [耗时: 4ms] ✨ 0 延迟!
```

### 在 Rust 引擎下 Seek（切换前）

```
⚡ [HybridPlayer] Seek → 10.00s [引擎: Rust] [耗时: 245ms]
⚡ [HybridPlayer] Seek → 20.50s [引擎: Rust] [耗时: 312ms]
```

---

## 📊 时间线总结

| 时间点 | 事件 | 累计时间 | 间隔 |
|--------|------|---------|------|
| T+0ms | 用户点击播放 | 0ms | - |
| T+2ms | 启动 Rust 流式 | 2ms | 2ms |
| T+95ms | **用户听到声音** 🔊 | 95ms | 93ms |
| T+96ms | 启动后台 Web Audio | 96ms | 1ms |
| T+739ms | Web Audio 加载完成 | 739ms | 643ms |
| T+740ms | 开始切换引擎 | 740ms | 1ms |
| T+745ms | 获取播放位置 | 745ms | 5ms |
| T+750ms | 停止 Rust | 750ms | 5ms |
| T+758ms | **引擎切换完成** ⚡ | 758ms | 8ms |

---

## 🎯 关键时间节点

### ✅ 用户听到声音：T+95ms
**从点击到听到声音只需 100ms！**

### ✅ 支持快速 Seek：T+758ms
**不到 1 秒后就支持 0 延迟 seek！**

### ✅ 总启动时间：T+758ms
**完整切换不到 1 秒！**

---

## 🔍 日志说明

### 时间格式

- `[14:35:28.456]` - 绝对时间（时:分:秒.毫秒）
- `T+95ms` - 相对时间（从点击播放开始）
- `耗时: 93ms` - 该操作的执行时间

### 引擎标识

- `[引擎: Rust]` - 使用 Rust 流式播放器
- `[引擎: Web Audio]` - 使用 Web Audio 播放器
- `✨ 0 延迟!` - Web Audio seek 标识

### 阶段标识

- `【阶段1】` - Rust 流式播放启动
- `【阶段2】` - Web Audio 后台加载
- `【阶段3】` - 引擎自动切换

---

## 🚀 测试方法

### 1. 刷新页面
```
F5 或 Ctrl+R
```

### 2. 打开开发者工具
```
F12 或 Ctrl+Shift+I
```

### 3. 清空控制台
```
Ctrl+L 或点击 Clear Console
```

### 4. 点击播放任意歌曲

### 5. 观察日志输出

应该看到：
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎵 [HybridPlayer] [时间] T+0ms - 播放: xxx
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⚡ T+2ms - 【阶段1】启动 Rust 流式播放...
✅ T+95ms - 用户听到声音了！
💾 T+96ms - 【阶段2】后台加载 Web Audio...
✅ T+739ms - Web Audio 后台加载完成
🔄 T+740ms - 【阶段3】准备切换引擎...
🎉 T+758ms - 引擎切换完成！
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 6. 测试 Seek

**在 T+758ms 之前 seek（使用 Rust）**：
```
⚡ Seek → 30.00s [引擎: Rust] [耗时: 245ms]
```

**在 T+758ms 之后 seek（使用 Web Audio）**：
```
⚡ Seek → 30.00s [引擎: Web Audio] [耗时: 3ms] ✨ 0 延迟!
```

---

## 📝 日志分析指标

### 性能指标

- **启动延迟**：T+95ms（用户听到声音）
- **切换完成**：T+758ms（支持快速 seek）
- **Web Audio 加载**：643ms
- **引擎切换**：18ms
- **Rust Seek**：200-500ms
- **Web Audio Seek**：< 10ms

### 期望值

| 指标 | 期望值 | 说明 |
|------|--------|------|
| 点击到声音 | < 100ms | Rust 流式启动 |
| Web Audio 加载 | 500-800ms | 文件读取+解码 |
| 引擎切换 | < 50ms | 获取位置+切换 |
| Rust Seek | 200-500ms | 正常延迟 |
| Web Audio Seek | < 10ms | 0 延迟 |

---

**现在刷新页面，点击播放，观察控制台日志！** 🚀

你应该能看到完整的三阶段流程和引擎切换过程！








