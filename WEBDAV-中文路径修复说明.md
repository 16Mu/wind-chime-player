# WebDAV ä¸­æ–‡è·¯å¾„æµè§ˆé—®é¢˜ä¿®å¤

## é—®é¢˜æè¿°

### é—®é¢˜1ï¼šä¸­æ–‡è·¯å¾„æ˜¾ç¤ºä¸ºç©º
åœ¨æµè§ˆåŒ…å«ä¸­æ–‡å­—ç¬¦çš„ WebDAV ç›®å½•æ—¶ï¼Œæ–‡ä»¶åˆ—è¡¨æ˜¾ç¤ºä¸ºç©ºï¼Œå³ä½¿è¯¥ç›®å½•ä¸‹ç¡®å®å­˜åœ¨æ–‡ä»¶ã€‚

### é—®é¢˜2ï¼šmount_path å¯¼è‡´è·¯å¾„æ¯”è¾ƒå¤±è´¥
é…ç½®äº† `mount_path`ï¼ˆå¦‚ `/webdav`ï¼‰åï¼Œæµè§ˆä»»ä½•ç›®å½•éƒ½æ˜¾ç¤ºä¸ºç©ºã€‚
- å‰ç«¯å‘é€ï¼š`/123`
- æœåŠ¡å™¨è¿”å›ï¼š`/webdav/123`
- è·¯å¾„ä¸åŒ¹é… â†’ æ‰€æœ‰æ–‡ä»¶è¢«è¿‡æ»¤

### é—®é¢˜3ï¼šå­ç›®å½•æµè§ˆæ—¶è·¯å¾„é‡å¤ï¼ˆæœ€å…³é”®ï¼ï¼‰
- **æ ¹ç›®å½•** `/`ï¼šå¯ä»¥æ­£å¸¸æµè§ˆ âœ…
- **è¿›å…¥å­ç›®å½•**ï¼šæ˜¾ç¤ºä¸ºç©º âŒ
- **åŸå› **ï¼šæœåŠ¡å™¨è¿”å›çš„è·¯å¾„åŒ…å« `mount_path`ï¼ˆ`/webdav/éŸ³ä¹`ï¼‰ï¼Œå‰ç«¯è¿›å…¥æ—¶åˆæ·»åŠ ä¸€æ¬¡ â†’ `/webdav/webdav/éŸ³ä¹` âŒ

## ä¿®å¤å†…å®¹

### åç«¯ä¿®å¤

1. **æ·»åŠ  `percent-encoding` ä¾èµ–**ï¼ˆä¿®å¤é—®é¢˜1ï¼‰
   - æ–‡ä»¶ï¼š`src-tauri/Cargo.toml`
   - æ·»åŠ äº† URL ç¼–ç /è§£ç æ”¯æŒ

2. **ä¿®å¤ä¸­æ–‡è·¯å¾„çš„ URL ç¼–ç é—®é¢˜**ï¼ˆä¿®å¤é—®é¢˜1ï¼‰
   - æ–‡ä»¶ï¼š`src-tauri/src/webdav/remote_adapter.rs`
   - åœ¨ `list_directory` æ–¹æ³•ä¸­å¯¹è¯·æ±‚è·¯å¾„å’Œè¿”å›æ–‡ä»¶è·¯å¾„ç»Ÿä¸€è¿›è¡Œ URL è§£ç 
   - ç¡®ä¿è·¯å¾„æ¯”è¾ƒæ—¶åŒæ–¹éƒ½å¤„äºç›¸åŒçš„ç¼–ç çŠ¶æ€

3. **ä¿®å¤ mount_path è·¯å¾„æ¯”è¾ƒé—®é¢˜**ï¼ˆä¿®å¤é—®é¢˜2ï¼‰
   - æ–‡ä»¶ï¼š`src-tauri/src/webdav/client.rs` - æ·»åŠ  `get_config()` æ–¹æ³•
   - æ–‡ä»¶ï¼š`src-tauri/src/webdav/remote_adapter.rs` - ä¿å­˜é…ç½®ä¿¡æ¯
   - åœ¨è·¯å¾„æ¯”è¾ƒæ—¶ï¼Œæ„å»ºå®Œæ•´çš„æœåŠ¡å™¨è·¯å¾„ï¼ˆåŒ…å« mount_pathï¼‰

4. **ä¿®å¤å­ç›®å½•è·¯å¾„é‡å¤é—®é¢˜**ï¼ˆä¿®å¤é—®é¢˜3 - æœ€å…³é”®ï¼ï¼‰
   - æ–‡ä»¶ï¼š`src-tauri/src/webdav/remote_adapter.rs`
   - åç«¯è¿”å›æ–‡ä»¶åˆ—è¡¨æ—¶ï¼Œå»é™¤è·¯å¾„ä¸­çš„ `mount_path` å‰ç¼€
   - å‰ç«¯åªå¤„ç†ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚ `/éŸ³ä¹` è€Œä¸æ˜¯ `/webdav/éŸ³ä¹`ï¼‰
   - é¿å…åœ¨è¿›å…¥å­ç›®å½•æ—¶é‡å¤æ·»åŠ  mount_path

### å‰ç«¯ä¿®å¤

4. **ä¿®å¤è·¯å¾„æ˜¾ç¤º**ï¼ˆä¿®å¤é—®é¢˜1ï¼‰
   - æ–‡ä»¶ï¼š`src/components/remote/FileBrowser.tsx`
   - æ·»åŠ  `decodePathForDisplay` å‡½æ•°å¯¹ URL ç¼–ç çš„è·¯å¾„è¿›è¡Œè§£ç 
   - æ›´æ–°é¢åŒ…å±‘å¯¼èˆªå’Œæ ‡é¢˜æ ï¼Œæ­£ç¡®æ˜¾ç¤ºä¸­æ–‡è·¯å¾„

## æµ‹è¯•æ­¥éª¤

### 1. é‡æ–°æ„å»ºåº”ç”¨

```bash
# å®‰è£…æ–°ä¾èµ–
cd src-tauri
cargo update

# æ„å»ºåº”ç”¨
npm run tauri dev
# æˆ–
npm run tauri build
```

### 2. æµ‹è¯•ä¸­æ–‡è·¯å¾„æµè§ˆ

1. æ‰“å¼€åº”ç”¨ï¼Œè¿›å…¥"è®¾ç½®" â†’ "è¿œç¨‹éŸ³ä¹æº"
2. ç‚¹å‡»"æµè§ˆ"æŒ‰é’®æ‰“å¼€æ–‡ä»¶æµè§ˆå™¨
3. å¯¼èˆªåˆ°åŒ…å«ä¸­æ–‡å­—ç¬¦çš„ç›®å½•
4. éªŒè¯ï¼š
   - âœ… æ–‡ä»¶åˆ—è¡¨åº”è¯¥æ­£ç¡®æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•
   - âœ… é¢åŒ…å±‘å¯¼èˆªåº”è¯¥æ˜¾ç¤ºè§£ç åçš„ä¸­æ–‡è·¯å¾„ï¼ˆä¸æ˜¯ `%E9%9F%B3...`ï¼‰
   - âœ… æ ‡é¢˜æ çš„"å½“å‰è·¯å¾„"åº”è¯¥æ˜¾ç¤ºä¸­æ–‡
   - âœ… å¯ä»¥æ­£å¸¸è¿›å…¥ä¸­æ–‡å‘½åçš„å­ç›®å½•
   - âœ… å¯ä»¥ç‚¹å‡»é¢åŒ…å±‘å¯¼èˆªè¿”å›ä¸Šçº§ç›®å½•

### 3. æŸ¥çœ‹æ—¥å¿—ï¼ˆå¯é€‰ï¼‰

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼š

```bash
# Windows
$env:RUST_LOG="info"
npm run tauri dev

# Linux/macOS
RUST_LOG=info npm run tauri dev
```

æ—¥å¿—ä¸­ä¼šæ˜¾ç¤ºï¼š
- ğŸ” è¯·æ±‚è·¯å¾„çš„åŸå§‹å€¼å’Œè§£ç åçš„å€¼
- ğŸ” mount_path é…ç½®å’Œå®Œæ•´è·¯å¾„æ„å»ºè¿‡ç¨‹
- ğŸ“„ æ¯ä¸ªè¿”å›æ–‡ä»¶çš„è·¯å¾„ä¿¡æ¯
- âœ‚ï¸ çˆ¶ç›®å½•è¿‡æ»¤çš„å†³ç­–è¿‡ç¨‹
- âœ… æœ€ç»ˆä¿ç•™çš„æ–‡ä»¶åˆ—è¡¨

**ç¤ºä¾‹æ—¥å¿—è¾“å‡ºï¼š**
```
ğŸ” WebDAV è¿”å› 3 ä¸ªåŸå§‹é¡¹ç›®ç”¨äºè·¯å¾„: '/123'
ğŸ” è§„èŒƒåŒ–çš„è¯·æ±‚è·¯å¾„: '/webdav/123' (åŸå§‹: '/123', mount_path: '/webdav')
  ğŸ“„ æ£€æŸ¥é¡¹ç›®: name='file.mp3', path='/webdav/123/file.mp3'
     è§£ç åçš„è·¯å¾„: '/webdav/123/file.mp3'
     è§„èŒƒåŒ–åçš„è·¯å¾„: '/webdav/123/file.mp3'
     æ¯”è¾ƒ: '/webdav/123/file.mp3' == '/webdav/123' ? false
    âœ… ä¿ç•™æ­¤é¡¹ç›®
ğŸ“ ç›®å½• '/123' æœ€ç»ˆç»“æœ: 2 ä¸ªé¡¹ç›®
```

## æŠ€æœ¯ç»†èŠ‚

### ä¿®å¤æµç¨‹

**é—®é¢˜1ï¼šä¸­æ–‡è·¯å¾„**
```
å‰ç«¯è¯·æ±‚ â†’ åç«¯æ¥æ”¶ â†’ URLè§£ç  â†’ è·¯å¾„æ¯”è¾ƒ â†’ å‰ç«¯æ˜¾ç¤º
   â†“           â†“          â†“          â†“          â†“
"/éŸ³ä¹"   "/éŸ³ä¹" æˆ–   ç»Ÿä¸€ä¸º     æ­£ç¡®è¿‡æ»¤    "éŸ³ä¹"
         "%E9%9F..."  "/éŸ³ä¹"    çˆ¶ç›®å½•     (è§£ç æ˜¾ç¤º)
```

**é—®é¢˜2+3ï¼šmount_path å’Œè·¯å¾„é‡å¤**
```
é…ç½®: mount_path="/webdav"

ã€æ ¹ç›®å½• - æ­£å¸¸ã€‘
å‰ç«¯è¯·æ±‚: "/"
    â†“
build_url: "https://example.com/webdav/"
    â†“
æœåŠ¡å™¨è¿”å›: ["/webdav/éŸ³ä¹", "/webdav/Python"]
    â†“
å»é™¤ mount_path: ["/éŸ³ä¹", "/Python"] â† è¿”å›ç›¸å¯¹è·¯å¾„
    â†“
å‰ç«¯æ˜¾ç¤º: æ­£å¸¸ âœ…

ã€è¿›å…¥å­ç›®å½• - ä¿®å¤åæ­£å¸¸ã€‘
å‰ç«¯ç‚¹å‡»: "/éŸ³ä¹" â† ç›¸å¯¹è·¯å¾„
    â†“
åç«¯æ·»åŠ  mount_path: "/webdav/éŸ³ä¹"
    â†“
build_url: "https://example.com/webdav/éŸ³ä¹" âœ…
    â†“
æœåŠ¡å™¨è¿”å›æ–‡ä»¶åˆ—è¡¨
    â†“
å»é™¤ mount_path åè¿”å›
    â†“
å‰ç«¯æ˜¾ç¤º: æ­£å¸¸ âœ…
```

### å…³é”®ä»£ç ä½ç½®

- **åç«¯è·¯å¾„è§£ç **ï¼š`src-tauri/src/webdav/remote_adapter.rs:39-42`
- **mount_path å¤„ç†**ï¼š`src-tauri/src/webdav/remote_adapter.rs:44-58`
- **å»é™¤ mount_path å‰ç¼€**ï¼š`src-tauri/src/webdav/remote_adapter.rs:88-102`ï¼ˆæœ€å…³é”®ï¼ï¼‰
- **é…ç½®è®¿é—®æ–¹æ³•**ï¼š`src-tauri/src/webdav/client.rs:336-339`
- **å‰ç«¯è·¯å¾„æ˜¾ç¤º**ï¼š`src/components/remote/FileBrowser.tsx:187-193`
- **URL ç¼–ç é…ç½®**ï¼š`src-tauri/src/webdav/types.rs:376-393`
- **XML è§£æè§£ç **ï¼š`src-tauri/src/webdav/xml_parser.rs:232-243`

## å·²çŸ¥å…¼å®¹æ€§

æ­¤ä¿®å¤å·²åœ¨ä»¥ä¸‹ WebDAV æœåŠ¡å™¨ä¸Šæµ‹è¯•é€šè¿‡ï¼š
- âœ… 123äº‘ç›˜
- âœ… Nextcloud
- âœ… ownCloud
- âœ… åšæœäº‘

## æ•…éšœæ’é™¤

### å¦‚æœä»ç„¶æ˜¾ç¤ºä¸ºç©º

1. **æ£€æŸ¥æ—¥å¿—è¾“å‡º**
   - ç¡®è®¤è·¯å¾„è§£ç æ˜¯å¦æ­£ç¡®
   - æŸ¥çœ‹ mount_path æ˜¯å¦æ­£ç¡®æ·»åŠ 
   - æ£€æŸ¥è·¯å¾„æ¯”è¾ƒçš„è¯¦ç»†è¿‡ç¨‹

2. **æ£€æŸ¥é…ç½®**
   - ç¡®è®¤ mount_path é…ç½®æ˜¯å¦æ­£ç¡®
   - å¦‚æœä¸ç¡®å®šï¼Œå¯ä»¥å…ˆè®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸² `""`

3. **ç¡®è®¤æœåŠ¡å™¨è¿”å›**
   - æ£€æŸ¥ WebDAV æœåŠ¡å™¨è¿”å›çš„ XML æ ¼å¼
   - æŸ¥çœ‹ `<href>` æ ‡ç­¾ä¸­çš„è·¯å¾„æ ¼å¼

4. **å°è¯•æ¸…ç©ºç¼“å­˜é‡æ–°åŠ è½½**

### å¦‚æœé¢åŒ…å±‘æ˜¾ç¤ºç¼–ç è·¯å¾„

1. æ£€æŸ¥å‰ç«¯æ§åˆ¶å°æ˜¯å¦æœ‰ JavaScript é”™è¯¯
2. ç¡®è®¤ `decodeURIComponent` å‡½æ•°æ˜¯å¦æ­£å¸¸å·¥ä½œ

## æ›´å¤šä¿¡æ¯

è¯¦ç»†çš„ä¿®å¤è®°å½•è¯·æŸ¥çœ‹ï¼š
- `log.md` ç¬¬ 437-499 è¡Œï¼ˆä¸­æ–‡è·¯å¾„ä¿®å¤ï¼‰
- `log.md` ç¬¬ 501-597 è¡Œï¼ˆmount_path ä¿®å¤ï¼‰
- `log.md` ç¬¬ 599-734 è¡Œï¼ˆ**å­ç›®å½•è·¯å¾„é‡å¤ä¿®å¤ - æœ€å…³é”®ï¼**ï¼‰

## é…ç½®ç¤ºä¾‹

### 123äº‘ç›˜
```json
{
  "url": "https://www.123pan.com",
  "mount_path": "/webdav",
  "username": "your_username",
  "password": "your_password"
}
```

### Nextcloud
```json
{
  "url": "https://your-nextcloud.com",
  "mount_path": "/remote.php/dav/files/username/",
  "username": "your_username",
  "password": "your_password"
}
```

### åšæœäº‘
```json
{
  "url": "https://dav.jianguoyun.com",
  "mount_path": "/dav/",
  "username": "your_email",
  "password": "app_password"
}
```

